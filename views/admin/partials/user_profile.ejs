<div class="container">
	<div class="avatar-upload">
		<div class="avatar-edit">
			<input type='file' id="imageUpload" name="user_profile_image" accept=".png, .jpg, .jpeg" />
			<label for="imageUpload"></label>
		</div>

		<div class="avatar-preview">
			<div id="imagePreview" class="circle responsive-img" style="background-image: url(/img.jpg);">
			</div>
		</div>
	</div>
</div>


<script>
	function readURL(input) {
		console.log('url', input.files)
		if (input.files && input.files[0]) {
			var reader = new FileReader();
			reader.onload = function (e) {
				$('#imagePreview').css('background-image', 'url(' + e.target.result + ')');
				$('#imagePreview').hide();
				$('#imagePreview').fadeIn(650);
				let fileExt = reader.result.split(';')[0].split('/')[1];
				let regexForImg = fileExt.toLowerCase() == 'jpeg' ? /^data:image\/jpeg;base64,/ :
					/^data:image\/png;base64,/;
				//decode base64 string
				console.log((reader.result.replace(regexForImg, "")).length)
				fileExt = fileExt.toLowerCase() === 'jpeg' ? 'jpg' : 'png';
				fetch('http://localhost:3000/user_profile_image', {
						method: 'post',
						body: JSON.stringify({
							userImgBase64: reader.result.replace(regexForImg, ""),
							ext: fileExt
						}),
						headers: {
							"Content-Type": 'application/json',
						}
					}).then(res => {
						return res.json();
					})
					.then(response => {
						console.log(response)
					}).catch(error => {
						console.log(error);
					})
			}
			reader.readAsDataURL(input.files[0]);
			console.log('reader', reader)
		}
	}

	$("#imageUpload").change(function () {
		readURL(this);
	});
</script>